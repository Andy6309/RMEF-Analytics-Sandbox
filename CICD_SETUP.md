# CI/CD Pipeline Setup

This document describes the GitHub Actions CI/CD pipelines configured for the RMEF Analytics Sandbox project.

## Pipeline Overview

### 1. **CI Pipeline** (`ci.yml`)
Runs on every push and pull request to `main` and `develop` branches.

**Jobs:**
- **Test Job**
  - Sets up Python 3.11
  - Caches dependencies for faster builds
  - Installs project dependencies
  - Runs ETL pipeline to generate test data
  - Executes pytest with coverage reporting
  - Uploads coverage reports to Codecov

- **Lint Job**
  - Runs Black (code formatter)
  - Runs isort (import sorting)
  - Runs Flake8 (linting)

**Purpose:** Ensures code quality and tests pass before merging changes.

### 2. **Deploy Pipeline** (`deploy.yml`)
Runs on push to `main` branch or manual trigger.

**Jobs:**
- Sets up Python environment
- Runs ETL pipeline
- Creates deployment artifacts
- Uploads dashboard package for deployment

**Purpose:** Prepares the dashboard for deployment to Streamlit Cloud or other hosting platforms.

### 3. **Data Quality Pipeline** (`data-quality.yml`)
Runs daily at 6 AM UTC or on manual trigger.

**Jobs:**
- Runs ETL pipeline
- Executes data quality tests
- Generates data quality report
- Uploads report as artifact (90-day retention)

**Purpose:** Monitors data quality and pipeline health on a regular schedule.

## Setup Instructions

### 1. Initialize Git Repository

```bash
cd "c:\Projects\RMEF Analytics Sandbox"
git init
git add .
git commit -m "Initial commit: RMEF Analytics Sandbox with CI/CD"
```

### 2. Create GitHub Repository

1. Go to https://github.com/new
2. Create a new repository named `rmef-analytics-sandbox`
3. Do NOT initialize with README (we already have one)

### 3. Push to GitHub

```bash
git remote add origin https://github.com/YOUR_USERNAME/rmef-analytics-sandbox.git
git branch -M main
git push -u origin main
```

### 4. Configure GitHub Actions

GitHub Actions will automatically run once you push. No additional configuration needed!

### 5. Optional: Add Codecov Integration

1. Go to https://codecov.io
2. Sign in with GitHub
3. Add your repository
4. Copy the token
5. Add it to GitHub Secrets: Settings → Secrets → New repository secret
   - Name: `CODECOV_TOKEN`
   - Value: Your token

## Pipeline Status Badges

Add these to your README.md:

```markdown
![CI Pipeline](https://github.com/YOUR_USERNAME/rmef-analytics-sandbox/workflows/CI%20Pipeline/badge.svg)
![Deploy Dashboard](https://github.com/YOUR_USERNAME/rmef-analytics-sandbox/workflows/Deploy%20Dashboard/badge.svg)
![Data Quality](https://github.com/YOUR_USERNAME/rmef-analytics-sandbox/workflows/Data%20Quality%20Checks/badge.svg)
```

## Deployment to Streamlit Cloud

### Option 1: Streamlit Cloud (Recommended)

1. Go to https://share.streamlit.io
2. Sign in with GitHub
3. Click "New app"
4. Select your repository: `rmef-analytics-sandbox`
5. Set main file path: `dashboards/app.py`
6. Click "Deploy"

### Option 2: Docker Deployment

Create a `Dockerfile`:

```dockerfile
FROM python:3.11-slim

WORKDIR /app

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

RUN python pipelines/etl_pipeline.py

EXPOSE 8501

CMD ["streamlit", "run", "dashboards/app.py", "--server.port=8501", "--server.address=0.0.0.0"]
```

Build and run:

```bash
docker build -t rmef-analytics .
docker run -p 8501:8501 rmef-analytics
```

## Monitoring and Maintenance

### View Pipeline Runs
- Go to your GitHub repository
- Click "Actions" tab
- View all workflow runs and their status

### Manual Triggers
- Navigate to Actions → Select workflow
- Click "Run workflow" button
- Choose branch and run

### Artifacts
- CI pipeline: Coverage reports (30 days)
- Deploy pipeline: Dashboard package (30 days)
- Data Quality pipeline: Quality reports (90 days)

## Best Practices

1. **Branch Protection**
   - Require CI pipeline to pass before merging
   - Require pull request reviews
   - Enable status checks

2. **Secrets Management**
   - Never commit sensitive data
   - Use GitHub Secrets for API keys
   - Use `.env` files locally (gitignored)

3. **Testing**
   - Maintain >80% code coverage
   - Add tests for new features
   - Run tests locally before pushing

4. **Data Quality**
   - Review daily data quality reports
   - Set up notifications for failures
   - Maintain 95%+ data quality baseline

## Troubleshooting

### Pipeline Fails on Windows-specific Code
- Ensure cross-platform compatibility
- Test on Ubuntu (GitHub Actions default)
- Use `pathlib.Path` instead of string paths

### Tests Pass Locally but Fail in CI
- Check Python version consistency
- Verify all dependencies in requirements.txt
- Check for environment-specific code

### Deployment Issues
- Verify all files are committed
- Check requirements.txt is complete
- Ensure database is generated by ETL pipeline

## Next Steps

1. ✅ Initialize Git repository
2. ✅ Create GitHub repository
3. ✅ Push code to GitHub
4. ✅ Verify CI pipeline runs successfully
5. ✅ Deploy to Streamlit Cloud
6. ✅ Add status badges to README
7. ✅ Set up branch protection rules
8. ✅ Configure notifications for pipeline failures
